{% extends "base.html" %}

{% block content %}
<div class="container-fluid p-0">
    <!-- Contacts View -->
    <div id="contactsView" class="view active">
        <header class="chat-header">
            <h1 class="app-title">Messages</h1>
            <div class="header-actions">
                <form id="uploadForm" class="d-inline-block me-2" aria-label="Upload data form">
                    <input type="file" id="fileUpload" class="d-none" accept=".csv,.xlsx" aria-label="Select file to upload">
                    <button type="button" class="btn btn-outline-primary btn-sm" id="uploadButton" aria-label="Upload file">
                        <i class="bi bi-upload me-1"></i> Import Data
                    </button>
                </form>
                <button class="theme-toggle btn btn-link" aria-label="Toggle theme">
                    <i class="bi bi-moon-fill"></i>
                </button>
            </div>
        </header>
        
        <div class="contacts-list">
            {% if contacts %}
                {% for contact in contacts %}
                    <div class="contact-item" data-contact="{{ contact.sender }}">
                        <div class="contact-info">
                            <span class="contact-name">{{ contact.sender }}</span>
                            <span class="last-message">{{ contact.text }}</span>
                        </div>
                        <div class="contact-time">
                            {{ contact.time }}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-contacts">
                    <p>No messages found</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Chat View -->
    <div id="chatView" class="view">
        <header class="chat-header">
            <button class="back-button btn btn-link" aria-label="Go back">
                <i class="bi bi-arrow-left"></i>
            </button>
            <span class="contact-name"></span>
            <button class="theme-toggle btn btn-link" aria-label="Toggle theme">
                <i class="bi bi-moon-fill"></i>
            </button>
        </header>
        
        <div class="messages-list">
            <!-- Messages will be loaded dynamically -->
        </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Error</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
            </div>
        </div>
    </div>
</div>

<!-- Upload Progress Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">Uploading File</h5>
            </div>
            <div class="modal-body text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Please wait while your file is being processed...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
